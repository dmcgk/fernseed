<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Responsive images using markdown in scrivener</title><style>@font-face{font-family:source sans pro;font-style:normal;font-weight:400;src:url(https://use.typekit.net/af/be76d4/00000000000000003b9b3129/27/l?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=n4&v=3)format("woff2")}@font-face{font-family:source sans pro;font-style:italic;font-weight:400;src:url(https://use.typekit.net/af/35658c/00000000000000003b9b312a/27/l?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=i4&v=3)format("woff2")}@font-face{font-family:source code pro;font-style:normal;font-weight:400;src:url(https://use.typekit.net/af/3c21b3/0000000000000000000179cf/27/l?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=n4&v=3)format("woff2")}@font-face{font-family:source serif pro;font-style:normal;font-weight:400;src:url(https://use.typekit.net/af/aa546d/00000000000000003b9b3a87/27/l?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=n4&v=3)format("woff2")}@font-face{font-family:source serif pro;font-style:italic;font-weight:400;src:url(https://use.typekit.net/af/190e58/00000000000000003b9b3a88/27/l?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=i4&v=3)format("woff2")}h1{text-align:left;font-weight:400;line-height:1.3;color:crimson}@media(prefers-color-scheme:dark){h1{color:#14dbb3}}h2{text-align:left;font-weight:400;line-height:1.3;color:crimson}@media(prefers-color-scheme:dark){h2{color:#14dbb3}}h3{text-align:left;font-weight:400;line-height:1.3;color:crimson}@media(prefers-color-scheme:dark){h3{color:#14dbb3}}h4{text-align:left;font-weight:400;line-height:1.3;color:crimson}@media(prefers-color-scheme:dark){h4{color:#14dbb3}}h5{text-align:left;font-weight:400;line-height:1.3;color:crimson}@media(prefers-color-scheme:dark){h5{color:#14dbb3}}h6{text-align:left;font-weight:400;line-height:1.3;color:crimson}@media(prefers-color-scheme:dark){h6{color:#14dbb3}}header{text-align:left;font-weight:400;line-height:1.3;color:crimson}@media(prefers-color-scheme:dark){header{color:#14dbb3}}html{height:100%}body{color:#000;background-color:#fff;padding:0;line-height:1.5;font-size:1.2rem;font-family:source sans pro,sans-serif;font-variant:common-ligatures oldstyle-nums proportional-nums;text-align:justify;margin-left:auto;margin-right:auto;position:relative;min-height:100%}@media(prefers-color-scheme:dark){body{color:#fff;background-color:#191919}}p{-ms-word-break:break-all;word-break:break-all;word-break:break-word;-webkit-hyphens:auto;-moz-hyphens:auto;hyphens:auto}p+.tagline{margin-top:1rem}.tagline+.tagline{margin-top:-1rem}em{font-style:italic}strong,footer{font-variant:small-caps oldstyle-nums proportional-nums;font-weight:400}pre{word-wrap:normal;padding:2rem 1rem}pre,code{font-family:source code pro,monospace;font-size:smaller}header,footer{margin:4rem 2rem;text-align:center}footer{position:absolute;bottom:0;right:0;left:0;font-size:smaller}section+footer{padding-bottom:4rem}footer a,.tagline a,.tagline time{margin:0 .2rem;font-variant:common-ligatures oldstyle-nums proportional-nums}a{color:crimson;text-decoration:none}@media(prefers-color-scheme:dark){a{color:#14dbb3}}a:hover{text-decoration:underline}img{width:100%;max-width:64rem;margin:2rem auto;display:block}h1 img,h2 img,h3 img,h4 img,h5 img,h6 img,p img{width:auto;margin:auto;display:inline;vertical-align:middle}svg{fill:crimson}@media(prefers-color-scheme:dark){svg{fill:#14dbb3}}figcaption{text-align:center;font-style:italic;font-size:smaller}section>:not(img),article>:not(img){margin:1rem auto;padding:0 2rem;max-width:48rem}article>h1,article>h2,article>h3,article>h4,article>h5,article>h6{margin:0 auto}h1+h1,h2+h1,h3+h1,h4+h1,h5+h1,h6+h1,h1+h2,h2+h2,h3+h2,h4+h2,h5+h2,h6+h2,h1+h3,h2+h3,h3+h3,h4+h3,h5+h3,h6+h3,h1+h4,h2+h4,h3+h4,h4+h4,h5+h4,h6+h4,h1+h5,h2+h5,h3+h5,h4+h5,h5+h5,h6+h5,h1+h6,h2+h6,h3+h6,h4+h6,h5+h6,h6+h6{margin:0 auto}section+footer{position:relative}blockquote{padding:0 1rem}blockquote,.micro-excerpt>:not(img){margin:0 auto;border-style:solid;border-width:0 0 0 6px;border-color:crimson}@media(prefers-color-scheme:dark){blockquote,.micro-excerpt>:not(img){border-color:#14dbb3}}article{padding:5vh 0 10rem}article+article{padding-top:0;margin-top:-10vh}ul li{margin:0 2rem}.avatar{width:1rem;height:1rem;border-radius:50%;object-fit:cover}.micro-excerpt>:last-child,.article-excerpt>:last-child{padding:0 2rem 1rem;margin:0 auto}.micro-excerpt>:first-child,.article-excerpt>:first-child{padding:1rem 2rem 0;margin:0 auto}.micro-excerpt>:not(img),.article-excerpt>:not(img){padding:0 2rem}.micro-excerpt ul{list-style-type:none}.micro-excerpt ul li{margin:0 auto}.micro-excerpt blockquote,.article-excerpt blockquote{padding:0;border-style:none;font-style:italic}.article-excerpt{margin:2rem 0}.categories{color:gray;padding-top:0;margin-top:0}.image-list{white-space:nowrap;overflow:auto}.gallery{display:grid;grid-template-columns:repeat(auto-fit,minmax(20rem,1fr));gap:1rem;margin:2rem 0;width:fit-content;margin:0 auto}.gallery img{width:100%;height:100%;object-fit:cover;max-height:40vh;max-width:100%;margin:2rem auto;border-radius:1rem;box-shadow:0 2px 8px rgba(0,0,0,.1);display:block}.image-list img,.featured-image img{max-height:50vh;max-width:100%;margin:2rem auto;width:auto;height:auto;border-radius:1rem;box-shadow:0 2px 8px rgba(0,0,0,.1);overflow:hidden;display:block}.micro-excerpt .image-list img,.micro-excerpt .featured-image img{max-height:25vh}.fiction p{margin:1rem auto 0;max-width:40rem;font-family:source serif pro,serif;font-variant:common-ligatures oldstyle-nums proportional-nums}.fiction>p+p{margin:0 auto;text-indent:1rem}.fiction>hr{margin:2rem;padding:0;border-width:0}.tag-cloud{display:flex;flex-wrap:wrap;gap:.5rem;list-style:none;padding:0}.tag-cloud .tag a{text-decoration:none;color:inherit}.tag-cloud .weight-1{font-size:.75rem}.tag-cloud .weight-2{font-size:1rem}.tag-cloud .weight-3{font-size:1.25rem}.tag-cloud .weight-4{font-size:1.5rem}.tag-cloud .weight-5{font-size:2rem;font-weight:700}.highlight{border-radius:15px}.tagline{text-align:right}.tagline svg{height:1rem}.social{padding:0 .5rem}article h1{position:relative}.navigation-element{position:absolute;left:.5rem}.toc{display:flex;align-items:baseline;gap:.5ch;white-space:nowrap;padding:.5rem 0}.toc .title,.toc .date{flex-shrink:0}.toc .dots{flex-grow:1;position:relative;height:1px;background-image:repeating-linear-gradient(to right,currentColor 0 1px,transparent 0 4px);background-size:auto 1px;background-repeat:repeat-x;background-position:50%;margin:0 .5ch}.toc .separator{display:none}.pagination{list-style:none;display:flex;gap:.5rem;justify-content:center;padding:2rem 0}.pagination li{margin:0}.pagination li a{text-decoration:none;padding:.4rem .8rem;color:crimson;opacity:.8}@media(prefers-color-scheme:dark){.pagination li a{color:#14dbb3}}.pagination li a:hover{opacity:1}.pagination li.active a{font-weight:700;color:#000}@media(prefers-color-scheme:dark){.pagination li.active a{color:#fff}}.pagination li.disabled a{opacity:.3;pointer-events:none}a.navigation-element:hover,header a:hover{text-decoration:none}#genre{font-variant:small-caps}#site-title{font-size:5rem}@media only screen and (max-width:64rem){section>:not(img),article>:not(img){max-width:70%}.fiction p{max-width:62%}}@media only screen and (max-width:48rem){body{text-align:left}.toc{display:block}.toc .separator{display:inline}.toc .dots{display:none}}@media only screen and (max-width:42rem){#site-title{font-size:3rem}body{font-size:1rem}section>:not(img),article>:not(img){max-width:80%}blockquote{font-style:italic}blockquote,.micro-excerpt>:not(img){border-width:0}.toc{display:block}.fiction p{max-width:80%}.micro-excerpt>:last-child,.article-excerpt>:last-child{padding:0 0 1rem}.micro-excerpt>:first-child,.article-excerpt>:first-child{padding:1rem 0 0}.toc .dots{display:none}.toc .separator{display:inline}}</style></head><body><header id=site-title><a href=/><span role=text aria-label=fernseed>Ꮅ̣</span></a></header><article class=technology><p>One of the main reasons to use [Markdown][#markdown] is to avoid any issues of layout, visual composition or rendering until after the actual content has been written. Unfortunately, when publishing something for the web, issues such as how content will display on different categories of devices do eventually need to be thought about. Image syntax in particular can be cumbersome in Markdown if you need to do something more complex than just specifying a single image and alt text.</p><p>There are multiple &lsquo;flavours&rsquo; of Markdown, some of which allow a (limited) set of expanded image attributes to be specified which can help, and the fallback to raw <strong>html</strong> syntax is always there as a backup, but the more those features are used the more the complexity of the plain text is increased, the less readable it becomes, and the more issues of layout need to be focused on up-front after all.</p><h2 id=inline-links>Inline Links</h2><p>Basic Markdown has a short &lsquo;inline link&rsquo; syntax which can be used to define your images. This is my own preferred method when working in Markdown in Scrivener, but I to also want to provide a set of alternative assets for different screen <strong>dpi</strong> if the post in question contains images, and assuming we&rsquo;re working with bitmaps, since not every type of image will be available as a vector.</p><p>If you just want &lsquo;2x&rsquo; images to be used in general and then scaled by the browser, then all you need to care about is making sure that your actual image asset is of the appropriate quality and that the image has its <code>width</code> attribute set to exactly half of the true width, all of which can be handled in something like the <a href=http://fletcherpenney.net/multimarkdown/>MultiMarkdown</a> flavour of Markdown like this:</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>[my-image]: http://my-image-location &#34;My Image Title&#34; width=&#34;96px&#34;
</span></span></code></pre></div><p>The major downside is the full-sized image attribute still needs to be retrieved in each case which is not ideal if you&rsquo;re trying to limit any mobile bandwidth impact.</p><h2 id=extended-image-attributes>Extended Image Attributes</h2><p>There are ways to deal with this &lsquo;properly&rsquo; and in an automated fashion, <em>if</em> your approach to naming and otherwise dealing with each asset can be managed in a predictable manner as part of your workflow.</p><p>For instance, let&rsquo;s say that we will always be dealing with a set of three variations on the same base image, with consistently named extensions (in this case, 2x and 3x for the higher <strong>dpi</strong> versions). Using [<code>kramdown</code>][#kramdown]&rsquo;s <strong>ial</strong> <a href=http://kramdown.gettalong.org/syntax.html#block-ials>extensions for blocks</a> and a Scrivener regex lets us produce arbitrarily verbose output from a relatively clean input. Note that this particular inline extension markup is only currently available in the <code>kramdown</code> Markdown flavour; so that I can specify additional <strong>html</strong> block-level attributes with this kind of notation:</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>[my-image]: http://my-image-location &#34;My Image Title&#34;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{: srcset=&#34;http://my-image-location-with-2x-suffix 2x&#34;}
</span></span></code></pre></div><p><code>srcset</code> is an <strong>html</strong> 5.1 proposal for dealing with image sets and seems to have at least partial support <a href="http://caniuse.com/#search=srcset">across a decent subset of modern browsers</a>, at least enough to recognise the &lsquo;<em>n</em>x&rsquo; part of the syntax. Worst case, browsers which don&rsquo;t recognise the attribute will fall back to using the normal <code>src</code> specified.</p><p>Other Markdown compilers do sometimes offer alternative mechanisms extended image attributes, but unfortunately there&rsquo;s no single, common or widespread syntax. For those not using <code>kramdown</code>, or for those running Jekyll blogs on GitHub Pages which as of the date of this post does not support a version of <code>kramdown</code> with the block <strong>ial</strong> support, using raw inline <strong>html</strong> may be the best option:</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#bb9af7>a</span> <span style=color:#7aa2f7>href</span><span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>&#34;/assets/images/logo@3x.png&#34;</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#bb9af7>img</span>
</span></span><span style=display:flex><span>    <span style=color:#7aa2f7>srcset</span><span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>&#34;/assets/images/logo@2x.png 2x, /assets/images/logo@3x.png 3x&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#7aa2f7>src</span><span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>&#34;/assets/images/logo.png&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#7aa2f7>alt</span><span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>&#34;A lovely fleuron&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#7aa2f7>title</span><span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>&#34;A lovely fleuron&#34;</span>
</span></span><span style=display:flex><span>  /&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#bb9af7>a</span>&gt;
</span></span></code></pre></div><h2 id=automatation--scripting>Automatation & Scripting</h2><p>So Let&rsquo;s say I&rsquo;m writing something in Markdown, and I want to keep the plain text version of a file reasonably clean, but I want to specify more than one DPI level of an image <em>and</em> have the highest-resolution version of the image viewable via a click. Rather than my having to type all that boilerplate in each time, I would want to write the smaller initial syntax and have it replaced with the second block above with the additional block level attribute. Optionally I would also like to link to the largest asset available from the image so that visitors can choose to <em>embiggen</em> it on their device if required.</p><p>I&rsquo;d need to capture the value of <code>http://my-image-location</code> so I can use it in two places in the replacement, the second time with a 2x suffix.</p><p>Matching regex:</p><pre tabindex=0><code>^!\[(.+)\]\((.+)\.(.+)\)
</code></pre><p>Substitution regex, note that for some reason the Scrivener regex does not accept <code>\n</code> as a new line character, so you&rsquo;ll need to option-enter any line breaks:</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>![$1][]
</span></span><span style=display:flex><span>[$1]: /assets/images/$2.$3 &#34;$1&#34; srcset=&#34;/assets/images/$2<span style=color:#7dcfff>@2x</span>.$3 2x&#34;
</span></span></code></pre></div><p>You can test these visually at the really-very-useful-indeed <a href=http://regexr.com>Regexr site</a> or using an app such as <a href=http://krillapps.com/patterns/>Patterns</a>.</p><p>So now I have a &lsquo;clean&rsquo; set of Markdown which will also happily display images correctly when previewed in something like [Marked][#Marked]. In this case, also assuming the image assets are in the same folder as the Scrivener project. You can add relative image paths if you don&rsquo;t mind typing a few more characters!</p><p>If you&rsquo;re using GitHub Pages to host your content then <code>kramdown</code> 1.5 is still in use, with the <strong>ial</strong> block level support only appearing in 1.6. Version 1.8 with support for block-level <strong>ial</strong>s for images currently has <a href=https://github.com/github/pages-gem/pull/155>an open pull request</a>. As soon as it&rsquo;s merged you&rsquo;ll get this behaviour &lsquo;out of the box&rsquo; for standard GitHub Pages hosted sites.</p><h2 id=example>Example</h2><p>This is the initial, minimal, Markdown as typed in Scrivener:</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>![<span style=color:#bb9af7>A lovely fleuron</span>](<span style=color:#7aa2f7>logo.png</span>)
</span></span></code></pre></div><p>This is the full Markdown present in the file created by the Scrivener compilation step:</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>[![A lovely fleuron][]](/assets/images/logo<span style=color:#7dcfff>@3x</span>.png)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[A lovely fleuron]: /assets/images/logo.png &#34;A lovely fleuron&#34;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{: srcset=&#34;/assets/images/logo<span style=color:#7dcfff>@2x</span>.png 2x, /assets/images/logo<span style=color:#7dcfff>@3x</span>.png 3x&#34; }
</span></span></code></pre></div><p>And this is its final <strong>html</strong> after the Jekyll conversion step:</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#bb9af7>a</span> <span style=color:#7aa2f7>href</span><span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>&#34;/assets/images/logo@3x.png&#34;</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#bb9af7>img</span>
</span></span><span style=display:flex><span>    <span style=color:#7aa2f7>srcset</span><span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>&#34;/assets/images/logo@2x.png 2x, /assets/images/logo@3x.png 3x&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#7aa2f7>src</span><span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>&#34;/assets/images/logo.png&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#7aa2f7>alt</span><span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>&#34;A lovely fleuron&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#7aa2f7>title</span><span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>&#34;A lovely fleuron&#34;</span>
</span></span><span style=display:flex><span>  /&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#bb9af7>a</span>&gt;
</span></span></code></pre></div><p>Ironically enough, the raw <strong>html</strong> may be <em>less</em> verbose than the fully-specified <code>kramdown</code> version. If you aren&rsquo;t convinced of any benefits of keeping your images in this kind of &lsquo;more-or-less Markdown&rsquo; syntax, you could just swap out the regex to replace the short form Markdown syntax with the <strong>html</strong> directly. Any Markdown processor will honour the <strong>html</strong> when it&rsquo;s being rendered:</p><div class=highlight><pre tabindex=0 style=color:#c0caf5;background-color:#1a1b26;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#bb9af7>a</span> <span style=color:#7aa2f7>href</span><span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>&#34;/assets/images/$2.$3&#34;</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#bb9af7>img</span>
</span></span><span style=display:flex><span>    <span style=color:#7aa2f7>srcset</span><span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>&#34;/assets/images/$2@2x.$3 2x, /assets/images/$2@3x.$3 3x&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#7aa2f7>src</span><span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>&#34;/assets/images/$2.$3&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#7aa2f7>alt</span><span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>&#34;$1&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#7aa2f7>title</span><span style=color:#9ece6a;font-weight:700>=</span><span style=color:#9ece6a>&#34;$1&#34;</span>
</span></span><span style=display:flex><span>  /&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#bb9af7>a</span>&gt;
</span></span></code></pre></div><p>With this change in place, <a href=/static-generation-dynamic-content/>prior articles on the site</a> will also now correctly render their images at the appropriate resolution for your device.</p><p class=tagline><a href=/technology>#Technology</a></p><p class=tagline><a href=/responsive-images-using-markdown-in-scrivener/><time datetime="2015-09-14 00:00:00 +0100 BST">September 14, 2015</time></a></p></article><footer><p><a href=/>Ꮅ̣ernseed</a>
&copy;2015<a rel=me href=https://mastodon.ie/@dmcgk>
<img src=/images/avatar_hu_608317e5ccd72982.webp alt=Avatar class=avatar></a></p></footer></body></html>